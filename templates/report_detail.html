{% extends "base.html" %}

{% block title %}Report – {{ report.title }}{% endblock %}
{% block page_title %}<i class="fas fa-file-alt"></i> {{ report.title }}{% endblock %}

{% block content %}
<div class="card">
  <div class="detail-grid">
    <div class="detail-item"><label>Report Number</label><span>{{ report.report_number or '—' }}</span></div>
    <div class="detail-item"><label>Date</label><span>{{ report.report_date or '—' }}</span></div>
    <div class="detail-item"><label>Source Company</label><span>{{ report.source_company or '—' }}</span></div>
    <div class="detail-item"><label>Created</label><span>{{ report.created_at.strftime('%Y-%m-%d %H:%M') }}</span></div>
  </div>
  {% if report.notes %}
  <div style="margin-top:1rem;">
    <label class="text-sm text-muted" style="text-transform:uppercase;font-weight:700;">Notes</label>
    <p>{{ report.notes }}</p>
  </div>
  {% endif %}
  {% if report.file_path %}
  <div style="margin-top:1rem;">
    <a href="{{ url_for('uploaded_file', filename=report.file_path) }}" target="_blank" class="btn btn-primary">
      <i class="fas fa-download"></i> Download {{ report.original_filename }}
    </a>
  </div>
  {% endif %}
</div>

<!-- Linked Calibrations -->
<div class="card">
  <div class="card-header">
    <h2><i class="fas fa-link"></i> Linked Calibrations</h2>
  </div>
  {% if linked_cals %}
  <div class="table-wrap">
    <table>
      <thead>
        <tr><th>Tool</th><th>Date</th><th>Result</th><th>Performed By</th></tr>
      </thead>
      <tbody>
        {% for cal in linked_cals %}
        <tr>
          <td><a href="{{ url_for('tool_detail', tool_id=cal.tool.id) }}">{{ cal.tool.name }} ({{ cal.tool.log_number }})</a></td>
          <td>{{ cal.calibration_date }}</td>
          <td><span class="badge badge-{{ cal.result }}">{{ cal.result | upper }}</span></td>
          <td>{{ cal.performed_by or '—' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="text-muted">No calibrations linked to this report yet.</p>
  {% endif %}
</div>
{% endblock %}
